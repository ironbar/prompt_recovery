
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ironbar.github.io/prompt_recovery/modeling/Iteration_02_prompt_engineering/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>Iteration 2. Prompt engineering - prompt_recovery</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#iteration-2-prompt-engineering" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="prompt_recovery" class="md-header__button md-logo" aria-label="prompt_recovery" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            prompt_recovery
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Iteration 2. Prompt engineering
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ironbar/prompt_recovery" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../01_Business_Understanding/" class="md-tabs__link">
      Business Understanding
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../02_Data_Understanding/" class="md-tabs__link">
      Data Understanding
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link md-tabs__link--active">
        Modeling
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../05_Solution_Summary/" class="md-tabs__link">
      Solution Summary
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../utils/00_Challenge_Workflow/" class="md-tabs__link">
        Utils
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="prompt_recovery" class="md-nav__button md-logo" aria-label="prompt_recovery" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    prompt_recovery
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ironbar/prompt_recovery" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../01_Business_Understanding/" class="md-nav__link">
        Business Understanding
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../02_Data_Understanding/" class="md-nav__link">
        Data Understanding
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">Modeling</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Modeling" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Modeling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_01_biggest_model/" class="md-nav__link">
        Iteration 1. Biggest model
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Iteration 2. Prompt engineering
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Iteration 2. Prompt engineering
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goal" class="md-nav__link">
    Goal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    Motivation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development" class="md-nav__link">
    Development
  </a>
  
    <nav class="md-nav" aria-label="Development">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cleaning-the-datasets" class="md-nav__link">
    Cleaning the datasets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slow-evaluation" class="md-nav__link">
    Slow evaluation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    Results
  </a>
  
    <nav class="md-nav" aria-label="Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#first-prompt-engineering-optimizations" class="md-nav__link">
    First prompt engineering optimizations
  </a>
  
    <nav class="md-nav" aria-label="First prompt engineering optimizations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#number-of-output-tokens" class="md-nav__link">
    Number of output tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#second-steps" class="md-nav__link">
    Second steps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    Next steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#todo" class="md-nav__link">
    TODO
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_03_study_leaked_data/" class="md-nav__link">
        Iteration 3. Study Leaked data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_04_create_new_data/" class="md-nav__link">
        Iteration 4. Create new data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_05_fine-tune_mixtral/" class="md-nav__link">
        Iteration 5. Mixtral fine-tuning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_06_few_shot_prompt_engineering/" class="md-nav__link">
        Iteration 6. Few shot prompt engineering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_07_pause_and_analysis/" class="md-nav__link">
        Iteration 7. Pause and analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_08_create_high_quality_hard_dataset/" class="md-nav__link">
        Iteration 8. Create a high quality hard dataset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_09_mean_prompt_optimization/" class="md-nav__link">
        Iteration 9. Mean prompt optimization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_10_fine-tune_on_high_quality_data/" class="md-nav__link">
        Iteration 10. Fine-tune on high quality data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_11_llama_2/" class="md-nav__link">
        Iteration 11. Llama 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_12_other_models/" class="md-nav__link">
        Iteration 12. Fine-tuning Phi-2 and Gemma
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_13_datacentric_mistral/" class="md-nav__link">
        Iteration 13. Data centric approach around Mistral 7B
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_14_more_high_quality_data/" class="md-nav__link">
        Iteration 14. More high quality data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_15_prompt_tuning/" class="md-nav__link">
        Iteration 15. Prompt tuning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_16_similar_prompts/" class="md-nav__link">
        Iteration 16. Similar prompts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_17_scale_the_data/" class="md-nav__link">
        Iteration 17. Scale the data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_18_generate_data_with_gemma/" class="md-nav__link">
        Iteration 18. Generate data with Gemma
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_19_plan_last_submission/" class="md-nav__link">
        Iteration 19. Plan the last submissions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_n/" class="md-nav__link">
        Iteration n. Iteration_title
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../05_Solution_Summary/" class="md-nav__link">
        Solution Summary
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" data-md-state="indeterminate" type="checkbox" id="__nav_5" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          Utils
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Utils" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/00_Challenge_Workflow/" class="md-nav__link">
        Challenge workflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/markdown_cheatsheet/" class="md-nav__link">
        Markdown cheatsheet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/methodology/" class="md-nav__link">
        Methodology
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goal" class="md-nav__link">
    Goal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    Motivation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development" class="md-nav__link">
    Development
  </a>
  
    <nav class="md-nav" aria-label="Development">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cleaning-the-datasets" class="md-nav__link">
    Cleaning the datasets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slow-evaluation" class="md-nav__link">
    Slow evaluation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    Results
  </a>
  
    <nav class="md-nav" aria-label="Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#first-prompt-engineering-optimizations" class="md-nav__link">
    First prompt engineering optimizations
  </a>
  
    <nav class="md-nav" aria-label="First prompt engineering optimizations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#number-of-output-tokens" class="md-nav__link">
    Number of output tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#second-steps" class="md-nav__link">
    Second steps
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    Next steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#todo" class="md-nav__link">
    TODO
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/ironbar/prompt_recovery/edit/master/docs/modeling/Iteration_02_prompt_engineering.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="iteration-2-prompt-engineering">Iteration 2. Prompt engineering</h1>
<p><em>21-03-2024</em></p>
<!---
The work is done using short iterations. Each iteration needs to have a very
clear goal. This allows to gain greater knowledge of the problem on each iteration.
--->

<h2 id="goal">Goal</h2>
<p>Can we improve the baseline leaderboard score of 0.52 of Mixtral using prompt engineering?</p>
<p>We will have to implement some validation and test evaluations to be able to do prompt engineering.</p>
<h2 id="motivation">Motivation</h2>
<p>We already know that Mixtral is going to be our workhorse for the challenge and that the input to the model should be below 7200 tokens. Now is the time to see how much we can improve simply with prompt engineering and few shot prompting.</p>
<h2 id="development">Development</h2>
<h3 id="cleaning-the-datasets">Cleaning the datasets</h3>
<p>I have downloaded 6 datasets and iteratively created code to clean the datasets. Most of the cleaning
was done to remove Gemma starts that give hints of the prompt used. For example very frequently
answers start by <code>Sure, here is your rewritten text:</code>.</p>
<p>I also removed some of the samples where Gemma refused to answer.</p>
<p>The process of finding the patterns to clean the data was done iteratively. I evaluated the datasets
using a model and then looked at the worse and best predictions.</p>
<h3 id="slow-evaluation">Slow evaluation</h3>
<p>Evaluating the 6 datasets can take around 90 minutes. Thus prompt engineering is slow because
if we want to measure small improvements we need that evaluation time.</p>
<p>I could use <a href="https://docs.mistral.ai/platform/pricing/">Mistral API</a> to accelerate evaluation. Assuming
that each request would use around 2500 input tokens, each dataset evaluation (around 300 samples) would
cost 0.7$, so the total evaluation in 6 datasets would be likely less than 4$. If I make 5 requests per
second that would be around 6 minutes.</p>
<h2 id="results">Results</h2>
<h3 id="first-prompt-engineering-optimizations">First prompt engineering optimizations</h3>
<p>These results are previous to data cleaning.</p>
<table>
<thead>
<tr>
<th>prompt</th>
<th>gemma_suppl_rewrite</th>
<th>leaderboard</th>
</tr>
</thead>
<tbody>
<tr>
<td>baseline</td>
<td>0.628</td>
<td>0.52</td>
</tr>
<tr>
<td>few shot markdown</td>
<td>0.691</td>
<td>0.58</td>
</tr>
<tr>
<td>few shot conversation</td>
<td>0.715</td>
<td>0.61</td>
</tr>
<tr>
<td>conversation + Improve the text to this</td>
<td>-</td>
<td>0.63</td>
</tr>
<tr>
<td>Improve the text to this</td>
<td>0.617</td>
<td>0.6</td>
</tr>
</tbody>
</table>
<ul>
<li>Adding 9 examples and changing the prompt slightly was enough to boost the score ~0.09</li>
<li>Merging the prediction with the simple text of <code>Improve the text to this</code> improves the LB even further.</li>
<li>With a template prompt of around 2k tokens the submission takes less than 6 hours.</li>
</ul>
<h4 id="number-of-output-tokens">Number of output tokens</h4>
<table>
<thead>
<tr>
<th>number of tokens</th>
<th>mean score</th>
</tr>
</thead>
<tbody>
<tr>
<td>10</td>
<td>0.588</td>
</tr>
<tr>
<td>25</td>
<td>0.637</td>
</tr>
<tr>
<td>50</td>
<td>0.639</td>
</tr>
<tr>
<td>75</td>
<td>0.639</td>
</tr>
</tbody>
</table>
<p>A small number of tokens is hurtful, but once a point is reached there is no point on allowing more
output tokens.</p>
<h4 id="second-steps">Second steps</h4>
<p>After data cleaning I have carried more thorough optimization:</p>
<table>
<thead>
<tr>
<th>prompt variations</th>
<th>gemma_suppl_rewrite</th>
<th>nbroad_v2</th>
<th>newtonbaba</th>
<th>dipamc77</th>
<th>alexxxsem</th>
<th>galileo</th>
<th>mean</th>
</tr>
</thead>
<tbody>
<tr>
<td>few shot conversation</td>
<td>0.698</td>
<td>0.609</td>
<td>0.672</td>
<td>0.634</td>
<td>0.574</td>
<td>0.647</td>
<td>0.639</td>
</tr>
<tr>
<td>add user and assistant names</td>
<td>0.694</td>
<td>0.606</td>
<td>0.656</td>
<td>0.61</td>
<td>0.572</td>
<td>0.632</td>
<td>0.628</td>
</tr>
<tr>
<td>more detailed intro</td>
<td>0.705</td>
<td>0.62</td>
<td>0.672</td>
<td>0.632</td>
<td>0.569</td>
<td>0.664</td>
<td>0.644</td>
</tr>
<tr>
<td>prompt instead of instruction</td>
<td>0.721</td>
<td>0.621</td>
<td>0.672</td>
<td>0.633</td>
<td>0.572</td>
<td>0.662</td>
<td>0.647</td>
</tr>
<tr>
<td>order instead of instruction</td>
<td>0.642</td>
<td>0.551</td>
<td>0.615</td>
<td>0.635</td>
<td>0.555</td>
<td>0.597</td>
<td>0.599</td>
</tr>
<tr>
<td>order instead of instruction v2</td>
<td>0.627</td>
<td>0.544</td>
<td>0.59</td>
<td>0.612</td>
<td>0.545</td>
<td>0.584</td>
<td>0.584</td>
</tr>
<tr>
<td>prompt and more detailed intro</td>
<td>0.717</td>
<td>0.623</td>
<td>0.679</td>
<td>0.65</td>
<td>0.581</td>
<td>0.674</td>
<td>0.654</td>
</tr>
<tr>
<td>Improve response start</td>
<td>0.724</td>
<td>0.623</td>
<td>0.68</td>
<td>0.647</td>
<td>0.577</td>
<td>0.665</td>
<td>0.653</td>
</tr>
<tr>
<td>Original and rewritten text in a single message</td>
<td>0.711</td>
<td>0.622</td>
<td>0.675</td>
<td>0.615</td>
<td>0.572</td>
<td>0.651</td>
<td>0.641</td>
</tr>
<tr>
<td>chatgpt intro</td>
<td>0.713</td>
<td>0.627</td>
<td>0.671</td>
<td>0.635</td>
<td>0.579</td>
<td>0.67</td>
<td>0.649</td>
</tr>
<tr>
<td>reorder the introduction</td>
<td>0.719</td>
<td>0.627</td>
<td>0.68</td>
<td>0.65</td>
<td>0.587</td>
<td>0.676</td>
<td>0.657</td>
</tr>
</tbody>
</table>
<p>By adding a more detailed intro (better definition of the task) and replacing the word "instruction" by
"text prompt" I was able to improve the mean scs score from <code>0.639</code> to <code>0.657</code>.</p>
<table>
<thead>
<tr>
<th>prompt variations</th>
<th>mean validation</th>
<th>public lb</th>
<th>public lb + 'Improve the text to this'</th>
</tr>
</thead>
<tbody>
<tr>
<td>few shot conversation</td>
<td>0.639</td>
<td>0.61</td>
<td>0.63</td>
</tr>
<tr>
<td>prompt and more detailed intro</td>
<td>0.654</td>
<td>0.6</td>
<td>0.62</td>
</tr>
<tr>
<td>reorder the introduction</td>
<td>0.657</td>
<td>0.6</td>
<td>0.62</td>
</tr>
</tbody>
</table>
<p>However when making submissions the validation result did not correlate with leaderboard.</p>
<h2 id="conclusion">Conclusion</h2>
<p>By using prompt engineering we were able to improve the leaderboard score from 0.52 to 0.63. We had
to use the trick of adding <code>Improve the text to this</code> to the submission, which highlights the importance
of imitating the style of the host's prompts.</p>
<p>The correlation between current local validation score and public leaderboard is not perfect. However it might be the case that it is simply the uncertainty of the evaluation, that I believe is close to 0.02 for the public leaderboard.</p>
<h2 id="next-steps">Next steps</h2>
<ul>
<li>Is fine-tuning necessary for this problem? Which data should I use to finetune?</li>
<li>Analyze the supplementary material</li>
<li>Make a list of real rewrite scenarios, not made up ones</li>
<li>Prepare more examples for few shot prompting, some of them must exploit the hints leave by Gemma.</li>
</ul>
<h2 id="todo">TODO</h2>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled checked/> Update the submission notebook to avoid loading the model when the test set is small and save GPU credits</li>
<li class="task-list-item"><input type="checkbox" disabled checked/> Which dataset I could use for validation?</li>
<li class="task-list-item"><input type="checkbox" disabled checked/> Set up a validation pipeline</li>
<li class="task-list-item"><input type="checkbox" disabled/> ~~Batch size speedup on inference~~</li>
<li class="task-list-item"><input type="checkbox" disabled checked/> Does the order of the prompt has an effect on inference time? YES</li>
</ul>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      2024-03-27
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../Iteration_01_biggest_model/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Iteration 1. Biggest model" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Iteration 1. Biggest model
            </div>
          </div>
        </a>
      
      
        
        <a href="../Iteration_03_study_leaked_data/" class="md-footer__link md-footer__link--next" aria-label="Next: Iteration 3. Study Leaked data" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Iteration 3. Study Leaked data
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://www.linkedin.com/in/guillermobarbadillo/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/guille_bar" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.youtube.com/channel/UCOHmUwHnd2hmUpiDzaQ1Isg" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.kaggle.com/ironbar" target="_blank" rel="noopener" title="www.kaggle.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M304.2 501.5 158.4 320.3 298.2 185c2.6-2.7 1.7-10.5-5.3-10.5h-69.2c-3.5 0-7 1.8-10.5 5.3L80.9 313.5V7.5q0-7.5-7.5-7.5H21.5Q14 0 14 7.5v497q0 7.5 7.5 7.5h51.9q7.5 0 7.5-7.5v-109l30.8-29.3 110.5 140.6c3 3.5 6.5 5.3 10.5 5.3h66.9q5.25 0 6-3z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a6c66575.min.js"></script>
      
        <script src="../../javascript/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>